{
  "alias": "opt_status",
  "name": "OPT STATUS",
  "descriptor": {
    "type": "latest",
    "sizeX": 8,
    "sizeY": 5,
    "resources": [],
    "templateHtml": "<div class=\"card\">\n    <div class=\"outerBox\" style=\"background:{{color}};color:{{color2}};font-size:{{fontSize}}px\">\n        <div class=\"innerbox entityId\" id=\"entityId\" style=\"background:{{color}};\">\n        </div>\n    </div>\n    <div class=\"button\" style=\"color:black;\">\n        <button (click)=\"reportbreakDown()\">{{b1}}</button>\n        <button (click)=\"inMaintenance()\">{{b2}}</button>\n        <button (click)=\"inOpertaion()\">{{b3}}</button>\n    </div>\n\n</div>",
    "templateCss": "*{\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\nhr{\n    border-style: dashed;\n    border-width: 1px;\n    display: block;\n      margin-top: 0.5em;\n      margin-bottom: 0.5em;\n      margin-left: auto;\n      margin-right: auto;\n}\n.card{\n    padding: 4px;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n}\n.innerbox{\n    padding: 3px;\n    width: 98%;\n    height: 95%;\n    overflow: scroll;\n}\n.button{\n    display: block;\n    align-items: center;\n    /*justify-content: space-between;*/\n}\n.button button{\n    font-size: 12px;\n    width: 30%;\n    margin-left: 1.5%;\n    height: 30px;\n    margin-right: 1.5%;\n    word-wrap: break-word;\n    margin-top: 5px;\n    margin-bottom: 5px;\n    color: black;\n}\n.outerBox{\n    width: 100%;\n    height: 90%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.border{\n    margin: 4px 0px ;\n    border-bottom: 1px solid #000;\n}",
    "controllerScript": "self.onInit = function() {\n    var $scope = self.ctx.$scope;\n    //var devtoken = self.ctx.data[0].datasource.entityName;\n    var devid= self.ctx.data[0].datasource.entityId;\n    $scope.color=self.ctx.settings.color;\n    $scope.color2=self.ctx.settings.color2;\n    $scope.fontSize=self.ctx.settings.fontSize;\n    $scope.b1=self.ctx.settings.button1Name;\n    $scope.b2=self.ctx.settings.button2Name;\n    $scope.b3=self.ctx.settings.button3Name;\n    allLog(devid);\n    function allLog(devid){\n    var devtoken = self.ctx.data[0].datasource.entityName;\n    var opt_status = self.ctx.settings.Operational_Status;\n    if(devtoken!=='undefined')\n    {\n    //devid=devid.replace(/[^a-zA-Z0-9]/g,'');\n    //console.log(devid);\n    //console.log(self.ctx.data);\n      var XHR2 = new XMLHttpRequest();\n    \t\tXHR2.open(\"GET\", \"api/audit/logs/entity/DEVICE/\"+devid+\"?pageSize=10&page=0&sortProperty=createdTime&sortOrder=DESC&startTime=\"+(Date.now()-1296000000)+\"&endTime=\"+(Date.now())+\"\");\n           //XHR2.open(\"GET\",\"api/plugins/telemetry/DEVICE/\"+devid+\"/values/attributes/SERVER_SCOPE\");\n            XHR2.setRequestHeader('X-Authorization','Bearer '+ localStorage.getItem(\"jwt_token\"));\n    \t\tXHR2.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n\n        var result;\n    \tXHR2.onload = function() {\n    \t    console.log(JSON.parse(XHR2.responseText));  \n    \t    result=JSON.parse(XHR2.responseText);\n    \t    console.log(result);\n    \tdocument.getElementById(\"entityId\").innerHTML=\"\";\n    \tfor(var key in result.data){\n    \t    var myDate = new Date( parseInt(result.data[key].createdTime));\n    \t    document.getElementById(\"entityId\").innerHTML+='<h7>'+myDate.toLocaleString()+','+result.data[key].entityName+'to state of '+result.data[key].actionData.attributes.Operational_Status+', updated by '+result.data[key].userName+'</h7><br>';\n    \t}\n    \t//console.log(result);\n    \t};\n        }\n    \t//var msg ='{\"deviceName\":'+devtoken+',\"operationalStatus\":'+opt_status+',\"customerName\":'+result.data[0].userName+',\"timestamp\":'+result.data[0].createdTime+'}';\n            \n        XHR2.send();\n    }\n\n    self.ctx.$scope.reportbreakDown=function() {\n        var devid= self.ctx.data[0].datasource.entityId;\n        var devtoken = self.ctx.data[0].datasource.entityName;\n        if(devid !=='undefined')\n        {\n        var url2 = \"https://thingsboard.cloud/api/v1/\"+devtoken+\"/attributes\";\n        //var url=\"/api/plugins/telemetry/DEVICE/\"+devid+\"/SERVER_SCOPE\";\n        var url=\"api/audit/logs/entity/DEVICE/\"+devid+\"?pageSize=1&page=0&sortProperty=createdTime&sortOrder=DESC&startTime=\"+(Date.now()-1296000000)+\"&endTime=\"+(Date.now())+\"\";\n        //var opt_status = self.ctx.settings.Operational_Status;\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", url);\n            xhr.setRequestHeader('X-Authorization','Bearer '+ localStorage.getItem(\"jwt_token\"));\n    \t\txhr.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n            xhr.setRequestHeader(\"Access-Control-Allow-Origin\",\"*\");\n            var result,userName,tstamp;\n            xhr.onreadystatechange = function() {\n            if (xhr.readyState === 4) {\n                console.log(xhr.status);\n                //console.log(xhr.responseText);\n                result=JSON.parse(xhr.responseText);\n                console.log(result);\n                userName=result.data[0].userName;\n                tstamp=result.data[0].createdTime;\n                console.log(\"username is \"+userName);\n            var xhr2 = new XMLHttpRequest();\n            xhr2.open(\"POST\", url2);\n            xhr2.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n            xhr2.setRequestHeader(\"Access-Control-Allow-Origin\",\"*\");\n            xhr2.onreadystatechange = function() {\n            if (xhr2.readyState === 4) {\n                console.log(xhr2.status);\n                console.log(xhr2.responseText);\n                //result=xhr.responseText;\n                \n            }\n        };\n\n        //var data = {  \"Operational_Status\":\"reportbreakDown\"};\n        var msg ='{\"deviceName\":'+devtoken+',\"Operational_Status\":'+'\"BREAKDOWN\"'+',\"customerName\":'+userName+',\"timestamp\":'+tstamp+'}';\n            \n        xhr2.send(\"{\\\"msg\\\":\"+msg+\"}\");\n            }\n        };\n        \n        //var data = {  \"Operational_Status\":\"reportbreakDown\"};\n        //var msg ='{\"deviceName\":'+devtoken+',\"operationaStatus\":'+opt_status+',\"customerName\":'+result.data[0].userName+',\"timestamp\":'+result.data[0].createdTime+'}';\n        \n        xhr.send();\n        }\n    }\n    self.ctx.$scope.inMaintenance= function() {\n        var devid= self.ctx.data[0].datasource.entityId;\n        var devtoken = self.ctx.data[0].datasource.entityName;\n        //var url = \"https://thingsboard.cloud/api/v1/Q0aP5Ej0bJ3uyIEBwFZh/attributes\";\n        if(devid!=='undefined')\n        {\n        var url2 = \"https://thingsboard.cloud/api/v1/\"+devtoken+\"/attributes\";\n        //var url=\"/api/plugins/telemetry/DEVICE/\"+devid+\"/SERVER_SCOPE\";\n        var url=\"api/audit/logs/entity/DEVICE/\"+devid+\"?pageSize=1&page=0&sortProperty=createdTime&sortOrder=DESC&startTime=\"+(Date.now()-1296000000)+\"&endTime=\"+(Date.now())+\"\";\n        //var opt_status = self.ctx.settings.Operational_Status;\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", url);\n            xhr.setRequestHeader('X-Authorization','Bearer '+ localStorage.getItem(\"jwt_token\"));\n    \t\txhr.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n            xhr.setRequestHeader(\"Access-Control-Allow-Origin\",\"*\");\n            var result,userName,tstamp;\n            xhr.onreadystatechange = function() {\n            if (xhr.readyState === 4) {\n                //console.log(xhr.status);\n                //console.log(xhr.responseText);\n                result=JSON.parse(xhr.responseText);\n              //  console.log(result);\n                userName=result.data[0].userName;\n                tstamp=result.data[0].createdTime;\n            //    console.log(\"username is \"+userName);\n            var xhr2 = new XMLHttpRequest();\n            xhr2.open(\"POST\", url2);\n            xhr2.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n            xhr2.setRequestHeader(\"Access-Control-Allow-Origin\",\"*\");\n            xhr2.onreadystatechange = function() {\n            if (xhr2.readyState === 4) {\n                console.log(xhr2.status);\n                console.log(xhr2.responseText);\n                //result=xhr.responseText;\n                \n            }\n        };\n\n        //var data = {  \"Operational_Status\":\"reportbreakDown\"};\n        var msg ='{\"deviceName\":'+devtoken+',\"Operational_Status\":'+'\"IN MAINTENANCE\"'+',\"customerName\":'+userName+',\"timestamp\":'+tstamp+'}';\n            \n        xhr2.send(\"{\\\"msg\\\":\"+msg+\"}\");\n            }\n        };\n        xhr.send();\n        \n        }\n        \n    }\n    self.ctx.$scope.inOpertaion=function() {\n        var devid= self.ctx.data[0].datasource.entityId;\n        var devtoken = self.ctx.data[0].datasource.entityName;\n        //var url = \"https://thingsboard.cloud/api/v1/Q0aP5Ej0bJ3uyIEBwFZh/attributes\";\n        if(devid!=='undefined')\n        {\n        var url2 = \"https://thingsboard.cloud/api/v1/\"+devtoken+\"/attributes\";\n        //var url=\"/api/plugins/telemetry/DEVICE/\"+devid+\"/SERVER_SCOPE\";\n        var url=\"api/audit/logs/entity/DEVICE/\"+devid+\"?pageSize=1&page=0&sortProperty=createdTime&sortOrder=DESC&startTime=\"+(Date.now()-1296000000)+\"&endTime=\"+(Date.now())+\"\";\n        //var opt_status = self.ctx.settings.Operational_Status;\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", url);\n            xhr.setRequestHeader('X-Authorization','Bearer '+ localStorage.getItem(\"jwt_token\"));\n    \t\txhr.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n            xhr.setRequestHeader(\"Access-Control-Allow-Origin\",\"*\");\n            var result,userName,tstamp;\n            xhr.onreadystatechange = function() {\n            if (xhr.readyState === 4) {\n                console.log(xhr.status);\n                //console.log(xhr.responseText);\n                result=JSON.parse(xhr.responseText);\n                //console.log(result);\n                userName=result.data[0].userName;\n                tstamp=result.data[0].createdTime;\n            //    console.log(\"username is \"+userName);\n                var xhr2 = new XMLHttpRequest();\n                xhr2.open(\"POST\", url2);\n                xhr2.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\n                xhr2.setRequestHeader(\"Access-Control-Allow-Origin\",\"*\");\n                xhr2.onreadystatechange = function() {\n                if (xhr2.readyState === 4) {\n                    console.log(xhr2.status);\n                    console.log(xhr2.responseText);\n                    //result=xhr.responseText;\n                    \n                }\n        };\n\n        //var data = {  \"Operational_Status\":\"reportbreakDown\"};\n        var msg ='{\"deviceName\":'+devtoken+',\"Operational_Status\":'+'\"IN OPERATION\"'+',\"customerName\":'+userName+',\"timestamp\":'+tstamp+'}';\n            \n        xhr2.send(\"{\\\"msg\\\":\"+msg+\"}\");\n            }\n        };    \n        xhr.send();\n            \n        }\n}\n}",
    "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\"cardHtml\"],\n        \"properties\": {\n            \"buttonCss\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \".button button{\\n font-size: 12px;width: 30%;margin-left: 1.5%;height: 30px;margin-right: 1.5%;word-wrap: break-word;margin-top: 5px;margin-bottom: 5px;\\n}\"\n            },\n            \"button1Name\":{\n                \"type\":\"string\",\n                \"title\":\"Button1 Title\",\n                \"default\":\"REPORT BREAKDOWN\"\n            },\n            \"button2Name\":{\n                \"type\":\"string\",\n                \"title\":\"Button2 Title\",\n                \"default\":\"IN MAINTENANCE\"\n            },\n            \"button3Name\":{\n                \"type\":\"string\",\n                \"title\":\"Button3 Title\",\n                \"default\":\"IN OPERATION\"\n            },\n            \"fontSize\":{\n                \"type\":\"number\",\n                \"title\":\"Font Size\",\n                \"default\":\"14\"\n            },\n            \"color\":{\n                \"type\":\"string\",\n                \"title\":\"Background color\",\n                \"default\":\"gray\"\n            },\n            \"color2\":{\n                \"type\":\"string\",\n                \"title\":\"Font color\",\n                \"default\":\"black\"\n            }\n        }\n    },\n    \"form\": [\n        \"fontSize\",\n        \"button1Name\",\n        \"button2Name\",\n        \"button3Name\",\n        {\n            \"key\":\"color\",\n            \"type\":\"color\"\n        },\n        {\n            \"key\":\"color2\",\n            \"type\":\"color\"\n        },\n        {\n            \"key\": \"buttonCss\",\n            \"type\": \"css\"\n        }\n    ]\n}",
    "dataKeySettingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\"cardHtml\"],\n        \"properties\": {\n            \"cardCss\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \".card {\\n font-weight: bold; \\n}\"\n            },\n            \"cardHtml\": {\n                \"title\": \"HTML\",\n                \"type\": \"string\",\n                \"default\": \"<div class='card'>HTML code here</div>\"\n            },\n            \"button1Name\":{\n                \"type\":\"string\",\n                \"title\":\"Button1 Title\",\n                \"default\":\"REPORT BREAKDOWN\"\n            },\n            \"button2Name\":{\n                \"type\":\"string\",\n                \"title\":\"Button2 Title\",\n                \"default\":\"IN MAINTENANCE\"\n            },\n            \"button3Name\":{\n                \"type\":\"string\",\n                \"title\":\"Button3 Title\",\n                \"default\":\"IN OPERATION\"\n            },\n            \"fontSize\":{\n                \"type\":\"number\",\n                \"title\":\"Font Size\",\n                \"default\":\"14\"\n            },\n            \"color\":{\n                \"type\":\"string\",\n                \"title\":\"Background color\",\n                \"default\":\"gray\"\n            },\n            \"color2\":{\n                \"type\":\"string\",\n                \"title\":\"Font color\",\n                \"default\":\"gray\"\n            }\n        }\n    },\n    \"form\": [\n        \"fontSize\",\n        \"button1Name\",\n        \"button2Name\",\n        \"button3Name\",\n        {\n            \"key\":\"color\",\n            \"type\":\"color\"\n        },\n        {\n            \"key\":\"color2\",\n            \"type\":\"color\"\n        },\n        {\n            \"key\": \"cardCss\",\n            \"type\": \"css\"\n        },           \n        {\n            \"key\": \"cardHtml\",\n            \"type\": \"html\"\n        }    \n    ]\n}",
    "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"First\",\"color\":\"#2196f3\",\"settings\":{\"showLines\":true,\"fillLines\":true,\"showPoints\":false},\"_hash\":0.8587686344902596,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Second\",\"color\":\"#ffc107\",\"settings\":{\"showLines\":true,\"fillLines\":false,\"showPoints\":false},\"_hash\":0.12775350966079668,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"shadowSize\":4,\"fontColor\":\"#545454\",\"fontSize\":10,\"xaxis\":{\"showLabels\":true,\"color\":\"#545454\"},\"yaxis\":{\"showLabels\":true,\"color\":\"#545454\"},\"grid\":{\"color\":\"#545454\",\"tickColor\":\"#DDDDDD\",\"verticalLines\":true,\"horizontalLines\":true,\"outlineWidth\":1},\"legend\":{\"show\":true,\"position\":\"nw\",\"backgroundColor\":\"#f0f0f0\",\"backgroundOpacity\":0.85,\"labelBoxBorderColor\":\"rgba(1, 1, 1, 0.45)\"},\"decimals\":1,\"stack\":false,\"tooltipIndividual\":false},\"title\":\"OPT STATUS\",\"dropShadow\":true,\"enableFullscreen\":true,\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"mobileHeight\":null}"
  },
  "image": null,
  "description": null
}